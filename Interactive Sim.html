<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QC Micropipette 操作標準指引</title>
    <!-- 引入 Tailwind CSS (用於美觀排版) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 簡單的樣式設定 -->
    <style>
        body { font-family: "Microsoft JhengHei", "Segoe UI", sans-serif; }
        .tab-btn.active { background-color: #1e293b; color: white; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .tab-btn-fwd.active { background-color: #2563eb; color: white; }
        .tab-btn-rev.active { background-color: #f97316; color: white; }
        .step-item { transition: all 0.2s; }
        .step-item:hover { border-color: #cbd5e1; }
        .step-item.active-fwd { border-color: #3b82f6; background-color: #eff6ff; ring: 1px solid #3b82f6; }
        .step-item.active-rev { border-color: #f97316; background-color: #fff7ed; ring: 1px solid #f97316; }
        .step-circle.active-fwd { background-color: #2563eb; color: white; }
        .step-circle.active-rev { background-color: #f97316; color: white; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8">

    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-sm border border-gray-200 min-h-[600px] p-6">
        <!-- Header -->
        <header class="mb-8 border-b pb-4">
            <h1 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                <span class="bg-blue-600 text-white p-2 rounded-lg text-xl">QC</span>
                Micropipette 操作標準指引
            </h1>
            <p class="text-slate-600 mt-2">
                防止人為 OOS：正確選擇吸液模式（Forward vs Reverse）與操作手法圖解
            </p>
        </header>

        <!-- Tabs -->
        <div class="flex flex-wrap gap-4 mb-6">
            <button onclick="setTab('selection')" id="tab-selection" class="tab-btn px-6 py-3 rounded-lg font-medium transition-all bg-slate-100 text-slate-600 hover:bg-slate-200">
                1. 模式選擇矩陣
            </button>
            <button onclick="setTab('forward')" id="tab-forward" class="tab-btn-fwd px-6 py-3 rounded-lg font-medium transition-all bg-blue-50 text-blue-600 hover:bg-blue-100">
                2. 正向吸液法 (Standard)
            </button>
            <button onclick="setTab('reverse')" id="tab-reverse" class="tab-btn-rev px-6 py-3 rounded-lg font-medium transition-all bg-orange-50 text-orange-600 hover:bg-orange-100">
                3. 反向吸液法 (Reverse)
            </button>
        </div>

        <!-- Content Container -->
        <div id="content-area">
            <!-- Content will be injected here by JavaScript -->
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- DATA ---
        const liquidTypes = [
            { type: '一般水性溶液', examples: '純水、緩衝液 (Buffer)、稀酸、稀鹼', method: 'forward', reason: '標準液體，流動性佳，正向吸液可確保準確排空。' },
            { type: '高黏稠度液體', examples: '甘油 (Glycerol)、糖漿、Tween、Triton X-100', method: 'reverse', reason: '黏稠液體易沾黏吸管尖 (Tip) 壁，正向吸液會殘留導致體積不足；反向吸液可抵銷殘留誤差。' },
            { type: '高揮發性液體', examples: '甲醇 (Methanol)、乙醇 (Ethanol)、丙酮', method: 'reverse', reason: '揮發氣體會增加 Tip 內壓導致滴漏，反向吸液能減少此影響。' },
            { type: '易起泡液體', examples: '含介面活性劑溶液 (Surfactants)、蛋白質溶液', method: 'reverse', reason: '正向吸液的最後一步「吹出 (Blow-out)」會產生氣泡，反向吸液不執行吹出動作，避免氣泡。' },
            { type: '極微量體積', examples: '< 10 μL 的樣品', method: 'reverse', reason: '微量體積受表面張力影響大，反向吸液通常具有更好的再現性 (Precision)。' }
        ];

        const stepsData = {
            forward: [
                { title: "1. 準備 (Ready)", action: "按壓至第一段 (1st Stop)", desc: "在進入液體前，將按鈕透過拇指輕壓至感到阻力的第一停點。", plunger: 50, liquid: 0, arrow: 'down' },
                { title: "2. 吸液 (Aspiration)", action: "浸入液體並釋放按鈕", desc: "垂直浸入液面下 (2-4mm)，平穩釋放拇指回到原點。稍微停頓 1秒確保液體吸入完全。", plunger: 0, liquid: 60, arrow: 'up' },
                { title: "3. 排液 (Dispense)", action: "按壓至第一段 (1st Stop)", desc: "靠著容器壁，將按鈕平穩壓至第一停點，排出大部分液體。", plunger: 50, liquid: 5, arrow: 'down' },
                { title: "4. 吹出 (Blow-out)", action: "繼續按壓至第二段 (2nd Stop)", desc: "<strong>關鍵步驟</strong>：繼續用力壓至底（第二停點），強制排出 Tip 尖端剩餘液體。", plunger: 100, liquid: 0, arrow: 'down' },
                { title: "5. 歸位 (Release)", action: "移開並釋放按鈕", desc: "將 Tip 移開容器壁後，再鬆開拇指回到原點。退 Tip。", plunger: 0, liquid: 0, arrow: 'up' }
            ],
            reverse: [
                { title: "1. 準備 (Ready)", action: "按壓至第二段 (2nd Stop)", desc: "<strong>關鍵差異</strong>：在進入液體前，直接將按鈕壓到底（第二停點）。", plunger: 100, liquid: 0, arrow: 'down' },
                { title: "2. 吸液 (Aspiration)", action: "浸入液體並釋放按鈕", desc: "垂直浸入，平穩釋放回到原點。此時吸入體積 = 設定體積 + 額外體積。", plunger: 0, liquid: 85, arrow: 'up' },
                { title: "3. 排液 (Dispense)", action: "按壓至第一段 (1st Stop)", desc: "靠著容器壁，壓至<strong>第一停點</strong>即可。此時設定的準確體積已排出。", plunger: 50, liquid: 25, arrow: 'down' },
                { title: "4. 殘留 (Remainder)", action: "保持在第一段並移開", desc: "<strong>不要按到第二段</strong>。Tip 內會有剩餘液體，這是正常的。這些液體是用來補償誤差的。", plunger: 50, liquid: 25, arrow: 'none' },
                { title: "5. 廢棄 (Discard)", action: "排出剩餘液體或退 Tip", desc: "將剩餘的液體排回原樣品槽或直接退掉 Tip。<strong>不可</strong>排入分析樣品中。", plunger: 100, liquid: 0, arrow: 'down' }
            ]
        };

        // --- STATE ---
        let currentTab = 'selection';
        let currentStep = 0;

        // --- ICONS (SVG Strings for offline capability) ---
        const icons = {
            info: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>`,
            alert: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-600"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>`,
            check: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`,
            arrowDown: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><line x1="12" y1="5" x2="12" y2="19"/><polyline points="19 12 12 19 5 12"/></svg>`,
            arrowUp: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg>`
        };

        // --- RENDER FUNCTIONS ---
        function setTab(tab) {
            currentTab = tab;
            currentStep = 0;
            updateTabsUI();
            renderContent();
        }

        function setStep(index) {
            currentStep = index;
            renderContent();
        }

        function updateTabsUI() {
            // Reset classes
            document.getElementById('tab-selection').className = "tab-btn px-6 py-3 rounded-lg font-medium transition-all bg-slate-100 text-slate-600 hover:bg-slate-200 cursor-pointer";
            document.getElementById('tab-forward').className = "tab-btn-fwd px-6 py-3 rounded-lg font-medium transition-all bg-blue-50 text-blue-600 hover:bg-blue-100 cursor-pointer";
            document.getElementById('tab-reverse').className = "tab-btn-rev px-6 py-3 rounded-lg font-medium transition-all bg-orange-50 text-orange-600 hover:bg-orange-100 cursor-pointer";

            // Add active class
            if (currentTab === 'selection') document.getElementById('tab-selection').classList.add('active');
            if (currentTab === 'forward') document.getElementById('tab-forward').classList.add('active');
            if (currentTab === 'reverse') document.getElementById('tab-reverse').classList.add('active');
        }

        function renderContent() {
            const container = document.getElementById('content-area');
            
            if (currentTab === 'selection') {
                renderSelectionMatrix(container);
            } else {
                renderGuide(container);
            }
        }

        function renderSelectionMatrix(container) {
            let html = `
                <div class="p-4 md:p-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center text-slate-700">
                        ${icons.info}
                        <span class="ml-2">如何決定操作模式？</span>
                    </h2>
                    <div class="grid md:grid-cols-2 gap-4">
            `;

            liquidTypes.forEach(item => {
                const isFwd = item.method === 'forward';
                const borderColor = isFwd ? 'border-blue-500' : 'border-orange-500';
                const bgColor = isFwd ? 'bg-blue-50' : 'bg-orange-50';
                const badgeClass = isFwd ? 'bg-blue-200 text-blue-800' : 'bg-orange-200 text-orange-800';
                const methodText = isFwd ? '正向 (Forward)' : '反向 (Reverse)';

                html += `
                    <div class="p-4 rounded-lg border-l-4 ${borderColor} ${bgColor}">
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-lg text-slate-800">${item.type}</h3>
                            <span class="text-xs px-2 py-1 rounded font-bold uppercase ${badgeClass}">${methodText}</span>
                        </div>
                        <p class="text-sm text-slate-600 mt-1 font-mono">${item.examples}</p>
                        <p class="text-sm text-slate-700 mt-3 bg-white/50 p-2 rounded">
                            <span class="font-semibold">原因：</span>${item.reason}
                        </p>
                    </div>
                `;
            });

            html += `
                    </div>
                    <div class="mt-8 p-4 bg-yellow-50 border border-yellow-200 rounded-lg flex items-start">
                        <div class="shrink-0 mr-3">${icons.alert}</div>
                        <div>
                            <h4 class="font-bold text-yellow-800">QC 重點提醒</h4>
                            <p class="text-sm text-yellow-700 mt-1">
                                若 SOP 未特別規定，一般水溶液一律使用正向吸液。若遇到高黏度或易揮發樣品導致檢驗數據 RSD 過高，請評估是否應改用反向吸液並進行驗證。
                            </p>
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML = html;
        }

        function renderGuide(container) {
            const isFwd = currentTab === 'forward';
            const colorClass = isFwd ? 'text-blue-700' : 'text-orange-600';
            const title = isFwd ? '正向吸液法 (Forward Pipetting)' : '反向吸液法 (Reverse Pipetting)';
            const steps = stepsData[currentTab];
            const currentStepData = steps[currentStep];

            // Calculate Visuals
            const plungerPos = currentStepData.plunger;
            const liquidHeight = currentStepData.liquid;
            const plungerOffset = plungerPos * 0.8;
            const liquidTop = 188 + (80 - liquidHeight * 0.8);
            const liquidBorderH = 6 * (liquidHeight/100);
            const liquidFillH = liquidHeight * 0.8;

            let stepsHtml = '';
            steps.forEach((step, idx) => {
                const isActive = idx === currentStep;
                const activeClass = isActive 
                    ? (isFwd ? 'active-fwd' : 'active-rev') 
                    : 'border-gray-200 hover:border-gray-300 bg-white';
                
                const circleClass = isActive
                    ? (isFwd ? 'active-fwd' : 'active-rev')
                    : 'bg-gray-200 text-gray-500';
                
                const arrowIcon = step.action.includes('下') || step.action.includes('壓') ? icons.arrowDown : (step.action.includes('移開') ? '' : icons.arrowUp);

                stepsHtml += `
                    <div onclick="setStep(${idx})" class="step-item p-4 rounded-lg border cursor-pointer flex items-start gap-3 mb-4 ${activeClass}">
                        <div class="step-circle w-8 h-8 rounded-full flex items-center justify-center shrink-0 font-bold text-sm ${circleClass}">
                            ${idx + 1}
                        </div>
                        <div>
                            <h3 class="font-bold text-slate-800">${step.title}</h3>
                            <div class="text-sm font-semibold text-slate-700 mt-1 flex items-center">
                                ${arrowIcon} ${step.action}
                            </div>
                            <p class="text-sm text-slate-600 mt-1 leading-relaxed">${step.desc}</p>
                        </div>
                    </div>
                `;
            });

            const tipMsg = isFwd 
                ? "吸液時，請保持 Tip 垂直。吸液後請在液面下停留 1 秒，確保體積完全進入。"
                : "反向吸液最關鍵的是「不要吹出」。最後殘留在 Tip 內的液體請直接廢棄。";

            container.innerHTML = `
                <div class="p-4 md:p-6">
                    <div class="flex flex-col md:flex-row gap-8">
                        <!-- Left: Controls -->
                        <div class="flex-1">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-2xl font-bold flex items-center ${colorClass}">${title}</h2>
                                <span class="text-sm text-gray-500">步驟 ${currentStep + 1} / 5</span>
                            </div>
                            <div class="space-y-4">
                                ${stepsHtml}
                            </div>
                        </div>

                        <!-- Right: Visualizer -->
                        <div class="w-full md:w-80 shrink-0 flex flex-col items-center">
                            <div class="sticky top-6 w-full flex flex-col items-center">
                                <h3 class="text-center font-bold text-gray-500 mb-2 uppercase tracking-wider text-xs">Action Simulator</h3>
                                
                                <!-- Pipette Graphic -->
                                <div class="flex flex-col items-center justify-center bg-gray-50 p-6 rounded-xl border border-gray-200 h-80 w-64 shadow-inner relative">
                                    <div class="absolute top-2 left-2 text-xs text-gray-400 font-mono">Simulated View</div>
                                    
                                    <div class="relative w-12 h-48">
                                        <!-- Plunger Rod -->
                                        <div class="absolute left-1/2 -translate-x-1/2 w-2 bg-slate-400 transition-all duration-500 ease-in-out"
                                             style="top: ${plungerOffset}px; height: 160px; z-index: 10;">
                                            <div class="absolute -top-3 left-1/2 -translate-x-1/2 w-8 h-4 bg-blue-600 rounded-full shadow-md"></div>
                                        </div>

                                        <!-- Pipette Housing -->
                                        <div class="absolute top-10 left-1/2 -translate-x-1/2 w-10 h-32 bg-slate-200 rounded-t-lg border-x-2 border-t-2 border-slate-300 z-20 flex flex-col items-center pt-2">
                                            <div class="text-[10px] font-bold text-slate-500">200</div>
                                            <div class="w-6 h-8 bg-white border border-gray-300 mt-2 flex items-center justify-center font-mono text-xs">
                                                ${isFwd ? '100' : '100'}
                                            </div>
                                        </div>

                                        <!-- Tip Cone -->
                                        <div class="absolute top-[168px] left-1/2 -translate-x-1/2 w-0 h-0 border-l-[10px] border-l-transparent border-r-[10px] border-r-transparent border-t-[20px] border-t-slate-200 z-20"></div>

                                        <!-- Tip -->
                                        <div class="absolute top-[188px] left-1/2 -translate-x-1/2 w-0 h-0 border-l-[6px] border-l-transparent border-r-[6px] border-r-transparent border-t-[80px] border-t-blue-100/50 opacity-80 z-10 filter drop-shadow-sm"></div>
                                        
                                        <!-- Liquid -->
                                        <div class="absolute left-1/2 -translate-x-1/2 z-10 transition-all duration-500"
                                             style="
                                                top: ${liquidTop}px;
                                                width: 0; height: 0;
                                                border-left: ${liquidBorderH}px solid transparent;
                                                border-right: ${liquidBorderH}px solid transparent;
                                                border-top: ${liquidFillH}px solid #3b82f6;
                                                display: ${liquidHeight > 0 ? 'block' : 'none'};
                                             ">
                                        </div>
                                    </div>

                                    <!-- Labels -->
                                    <div class="absolute right-2 top-10 flex flex-col text-xs text-gray-500 h-24 justify-between font-mono">
                                        <div class="transition-colors ${plungerPos === 0 ? 'text-blue-600 font-bold' : ''}">Rest</div>
                                        <div class="transition-colors ${plungerPos === 50 ? 'text-blue-600 font-bold' : ''}">1st Stop</div>
                                        <div class="transition-colors ${plungerPos === 100 ? 'text-red-600 font-bold' : ''}">2nd Stop</div>
                                    </div>
                                </div>

                                <!-- Legends -->
                                <div class="mt-6 space-y-2 w-64">
                                    <div class="text-xs text-gray-500 text-center">按壓深度示意圖</div>
                                    <div class="flex items-center gap-2 text-sm bg-gray-100 p-2 rounded">
                                        <div class="w-3 h-3 bg-blue-600 rounded-full"></div>
                                        <span>第一段 (1st Stop): 校正體積點</span>
                                    </div>
                                    <div class="flex items-center gap-2 text-sm bg-gray-100 p-2 rounded">
                                        <div class="w-3 h-3 bg-red-600 rounded-full"></div>
                                        <span>第二段 (2nd Stop): 吹出/極限點</span>
                                    </div>
                                </div>

                                <!-- Tip Box -->
                                <div class="mt-6 p-3 bg-green-50 border border-green-200 rounded text-sm text-green-800 w-64">
                                    <div class="flex items-center font-bold mb-1">
                                        ${icons.check} 分析員小撇步
                                    </div>
                                    ${tipMsg}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Init
        setTab('selection');
    </script>
</body>
</html>